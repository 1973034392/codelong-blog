---
title: Markdownæ¸²æŸ“
sidebar: false
---
# Markdown Pro: ä¸€æ¬¾åŠŸèƒ½ä¸°å¯Œçš„ç½‘é¡µç‰ˆ Markdown ç¼–è¾‘å™¨

æˆ‘åœ¨å¤§äºŒå­¦ä¹ Javaæ—¶è¦çœ‹å¾ˆå¤šæ–‡æ¡£,ä½†æ˜¯æ‰‹æœºç«¯æ²¡æœ‰ä¸€ä¸ªåˆé€‚çš„ç¼–è¾‘å™¨,æ­£å¥½æˆ‘æ‰‹ä¸Šæœ‰ä¸€å°é—²ç½®çš„æœåŠ¡å™¨,æ‰€ä»¥æˆ‘è‡ªå·±ç¼–å†™äº†ä¸€ä¸ªMarkdownçš„æ¸²æŸ“å™¨

> **é¡¹ç›®æ¼”ç¤º: [é¡¹ç›®åœ°å€](https://markdown-3vc.pages.dev/)**

**Markdown Pro** æ˜¯ä¸€ä¸ªå¼ºå¤§ã€ç¾è§‚ä¸”åŠŸèƒ½é½å…¨çš„åœ¨çº¿ Markdown ç¼–è¾‘å™¨ï¼Œå®Œå…¨è¿è¡Œåœ¨æ‚¨çš„æµè§ˆå™¨ä¸­ã€‚å®ƒæ—¨åœ¨æä¾›ä¸€ä¸ªæ— ç¼çš„ã€æ‰€è§å³æ‰€å¾—çš„å†™ä½œä½“éªŒï¼Œçµæ„Ÿæ¥æºäº Typora ç­‰ä¼˜ç§€çš„æ¡Œé¢åº”ç”¨ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

è¿™ä¸ªé¡¹ç›®é›†æˆäº†ç°ä»£ Markdown ç¼–è¾‘å™¨æ‰€éœ€çš„å¤§éƒ¨åˆ†æ ¸å¿ƒåŠŸèƒ½ï¼š

- **å®æ—¶é¢„è§ˆä¸åŒæ­¥æ»šåŠ¨**: ç¼–è¾‘å™¨å’Œé¢„è§ˆåŒºå·¦å³åˆ†æ ï¼Œå†…å®¹ä¼šå®æ—¶æ¸²æŸ“ï¼Œå¹¶ä¸”æ»šåŠ¨æ—¶ä¸¤ä¾§ä¼šä¿æŒåŒæ­¥ï¼Œæä¾›æµç•…çš„å¯¹ç…§å†™ä½œä½“éªŒã€‚
- **åŒæ¨¡å¼åˆ‡æ¢**:
    - **å¯¹ç…§æ¨¡å¼**: ç»å…¸çš„ç¼–è¾‘/é¢„è§ˆåŒæ å¸ƒå±€ã€‚
    - **ä»…é¢„è§ˆæ¨¡å¼**: éšè—ç¼–è¾‘åŒºï¼Œä¸“æ³¨äºé˜…è¯»ï¼Œå¹¶è‡ªåŠ¨åœ¨å·¦ä¾§æ˜¾ç¤ºå¯äº¤äº’çš„æ–‡æ¡£å¤§çº²ã€‚
- **ä¸“ä¸šçš„ç¼–è¾‘å™¨**: ä½¿ç”¨ **CodeMirror** ä½œä¸ºæ ¸å¿ƒç¼–è¾‘å™¨ï¼Œæ”¯æŒ Markdown è¯­æ³•é«˜äº®ï¼Œè®©æ‚¨çš„æºæ–‡æœ¬ä¹Ÿæ¸…æ™°æ˜“è¯»ã€‚
- **Typora é£æ ¼ä¸»é¢˜**: é¢„è§ˆåŒºåŸŸçš„æ ·å¼åŸºäºä¼˜é›…çš„ `mdmdt-light` Typora ä¸»é¢˜è¿›è¡Œç¾åŒ–ï¼Œæä¾›å‡ºè‰²çš„é˜…è¯»è§‚æ„Ÿã€‚
- **ä¸°å¯Œçš„è¯­æ³•æ”¯æŒ**:
    - **LaTeX æ•°å­¦å…¬å¼**: é€šè¿‡ **KaTeX** åº“å®Œç¾æ¸²æŸ“è¡Œå†… (`$...$`) å’Œå—çº§ (`$$...$$`) çš„æ•°å­¦å…¬å¼ã€‚
    - **Mermaid å›¾è¡¨**: æ”¯æŒä½¿ç”¨ `mermaid` è¯­æ³•åˆ›å»ºæµç¨‹å›¾ã€åºåˆ—å›¾ã€ç”˜ç‰¹å›¾ç­‰å¤šç§å›¾è¡¨ã€‚
    - **ä»£ç é«˜äº®**: ä½¿ç”¨ **highlight.js** å¯¹å„ç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç å—è¿›è¡Œè¯­æ³•é«˜äº®ã€‚
    - **ä»»åŠ¡åˆ—è¡¨**: æ”¯æŒ `- [ ]` å’Œ `- [x]` æ ¼å¼çš„ä»»åŠ¡æ¸…å•ã€‚
- **é«˜åº¦å¯å®šåˆ¶çš„ç•Œé¢**:
    - **å¯è°ƒå®½åº¦å¯¼èˆªæ **: åœ¨ PC ç«¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ‹–åŠ¨è¾¹ç¼˜è‡ªç”±è°ƒæ•´ç›®å½•å¯¼èˆªæ çš„å®½åº¦ã€‚
    - **å…¨å±æ¨¡å¼**: ä¸€é”®è¿›å…¥æ²‰æµ¸å¼å†™ä½œå’Œé˜…è¯»ç¯å¢ƒã€‚
- **ä¾¿æ·çš„æ–‡æ¡£å¤„ç†**:
    - **æœ¬åœ°æ–‡ä»¶ä¸Šä¼ **: è½»æ¾æ‰“å¼€å¹¶ç¼–è¾‘æœ¬åœ°çš„ `.md` æ–‡ä»¶ã€‚
    - **å¯¼å‡ºä¸º PDF**: å°†æ‚¨æ¸²æŸ“åçš„ä½œå“ï¼ˆåŒ…å«ç›®å½•çš„é¢„è§ˆæ¨¡å¼å¸ƒå±€ï¼‰å¯¼å‡ºä¸ºé«˜è´¨é‡çš„ PDF æ–‡ä»¶ã€‚
- **å…¨é¢çš„å¹³å°é€‚é…**:
    - **å“åº”å¼è®¾è®¡**: ç•Œé¢ä¼šè‡ªåŠ¨é€‚é…æ‰‹æœºã€å¹³æ¿å’Œæ¡Œé¢ç”µè„‘ï¼Œåœ¨ç§»åŠ¨ç«¯ä¹Ÿèƒ½è·å¾—è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

æœ¬é¡¹ç›®å®Œå…¨ç”±å‰ç«¯æŠ€æœ¯æ„å»ºï¼Œæ— éœ€ä»»ä½•åç«¯æ”¯æŒã€‚

- **åŸºç¡€**: HTML, CSS, JavaScript
- **UI æ¡†æ¶**: [Tailwind CSS](https://tailwindcss.com/) - ç”¨äºå¿«é€Ÿæ„å»ºç°ä»£åŒ–ã€å“åº”å¼çš„ç”¨æˆ·ç•Œé¢ã€‚
- **Markdown è§£æ**: [Marked.js](https://marked.js.org/) - ä¸€ä¸ªå¿«é€Ÿçš„ Markdown è§£æå’Œç¼–è¯‘åº“ã€‚
- **æ ¸å¿ƒç¼–è¾‘å™¨**: [CodeMirror](https://codemirror.net/) - æä¾›è¯­æ³•é«˜äº®å’Œå¼ºå¤§ç¼–è¾‘åŠŸèƒ½çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚
- **ä»£ç å—é«˜äº®**: [highlight.js](https://highlightjs.org/) - è‡ªåŠ¨æ£€æµ‹å¹¶é«˜äº®ä»£ç å—çš„è¯­æ³•ã€‚
- **æ•°å­¦å…¬å¼**: [KaTeX](https://katex.org/) - å¿«é€Ÿã€æ˜“äºä½¿ç”¨çš„ JavaScript æ•°å­¦æ’ç‰ˆåº“ã€‚
- **å›¾è¡¨ç»˜åˆ¶**: [Mermaid.js](https://mermaid.js.org/) - é€šè¿‡æ–‡æœ¬å’Œä»£ç ç”Ÿæˆå›¾è¡¨å’Œæµç¨‹å›¾ã€‚
- **PDF å¯¼å‡º**: [jsPDF](https://github.com/parallax/jsPDF) & [html2canvas](https://html2canvas.hertzen.com/) - ååŒå·¥ä½œï¼Œå°† HTML å†…å®¹â€œæˆªå›¾â€å¹¶ç”Ÿæˆ PDF æ–‡ä»¶ã€‚

## ğŸš€ å¦‚ä½•è¿è¡Œ

ä¸éœ€è¦å¤æ‚çš„æ„å»ºæ­¥éª¤ï¼Œåªéœ€ï¼š

1. å°†é¡¹ç›®ä»£ç ä¿å­˜ä¸ºä¸€ä¸ª `.html` æ–‡ä»¶ï¼ˆä¾‹å¦‚ `markdown-editor.html`ï¼‰ã€‚
2. ç›´æ¥åœ¨ä»»ä½•ç°ä»£æµè§ˆå™¨ï¼ˆå¦‚ Chrome, Firefox, Edgeï¼‰ä¸­æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ã€‚

ä¸€åˆ‡å°±ç»ªï¼æ‚¨å¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨ã€‚


## é¡¹ç›®ä»£ç :

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown ç¼–è¾‘å™¨ (Typora é£æ ¼)</title>
  <!-- å¼•å…¥ Tailwind CSS ç”¨äºå¿«é€Ÿæ„å»º UI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥ marked.js ç”¨äºå°† Markdown è½¬æ¢ä¸º HTML -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- å¼•å…¥ KaTeX å’Œç›¸å…³æ‰©å±• -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js"></script>

  <!-- å¼•å…¥ highlight.js ç”¨äºä»£ç è¯­æ³•é«˜äº® -->
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
  <!-- å¼•å…¥ jsPDF å’Œ html2canvas ç”¨äºå¯¼å‡º PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- å¼•å…¥ CodeMirror ç¼–è¾‘å™¨åº“ -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/base16-light.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/markdown/markdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>

  <!-- å¼•å…¥ Mermaid.js ç”¨äºå›¾è¡¨æ¸²æŸ“ -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <style>
    /* åŸºç¡€å’Œé¢œè‰²å˜é‡ (æ¥è‡ª mdmdt-light.css) */
    :root {
      --bg-color: rgb(250, 250, 252);
      --bg-color2: rgb(236, 236, 238);
      --text-color: #000;
      --text-grey: #666;
      --text-code: #2f479f;
      --title-color: #070909;
      --border-color: #d2d2d2;
      --color-1: #3e69d7;
      --color-1-0-a: rgba(62, 105, 215, 0.15);
      --color-1-0-b: rgba(62, 105, 215, 0.06);
      --color-2: #f59102;
    }

    html, body {
      margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; background-color: var(--bg-color);
    }
    #app-container {
      display: flex; flex-direction: column; height: 100vh;
    }
    #main-content {
      flex-grow: 1; display: flex; overflow: hidden;
    }
    #preview-wrapper, .CodeMirror, #toc-container {
      height: 100%; overflow-y: auto;
    }
    .CodeMirror {
      border-right: 1px solid var(--border-color); font-family: 'Menlo', 'Monaco', 'Courier New', monospace; font-size: 16px; line-height: 1.6;
    }
    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    ::-webkit-scrollbar { width: 8px !important; height: 8px !important; }
    ::-webkit-scrollbar-thumb { border-radius: 4px !important; background: var(--border-color) !important; }
    ::-webkit-scrollbar-track { background: var(--bg-color2) !important; }
    html, html * { scrollbar-color: var(--border-color) var(--bg-color2) !important; scrollbar-width: thin !important; }

    /* Typora ä¸»é¢˜æ ·å¼ */
    .markdown-body {
      box-sizing: border-box; max-width: 980px; margin: 0 auto; padding: 32px 80px; color: var(--text-color); line-height: 1.6; letter-spacing: 0.6px; font-family: "PingFang SC", "Microsoft YaHei UI", "Microsoft YaHei", Arial, "Helvetica Neue", Helvetica, sans-serif;
    }
    .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6 {
      position: relative; line-height: 1.5; margin: 32px 0 18px; color: var(--title-color); letter-spacing: 2px; scroll-margin-top: 1rem;
    }
    .markdown-body h1 { font-size: 32px; border-bottom: 1px solid var(--border-color); font-weight: 700; }
    .markdown-body h2 { font-size: 28px; font-weight: 700; }
    .markdown-body h3 { font-size: 24px; font-weight: 600; }
    .markdown-body h4 { font-size: 20px; font-weight: 600; }
    .markdown-body h5 { font-size: 18px; font-weight: 600; }
    .markdown-body h6 { font-size: 16px; font-weight: 600; }
    .markdown-body a { color: var(--color-1); }
    .markdown-body a:hover { color: var(--color-2); }
    .markdown-body code { background: var(--color-1-0-a); color: var(--text-code); }
    .markdown-body pre {
      background: var(--bg-color2) !important;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 16px;
      overflow-x: auto;
    }
    .markdown-body pre code { background: transparent !important; }
    .markdown-body blockquote { background: var(--color-1-0-b); border-left: 4px solid var(--color-1); padding: 16px; margin-top: 16px; }
    .markdown-body table { border: 1px solid var(--border-color) !important; border-radius: 8px; border-collapse: separate; border-spacing: 0; overflow: hidden; margin-top: 16px; }
    .markdown-body table thead tr th { background: var(--bg-color2); }
    .markdown-body table tbody tr:nth-child(even) td { background: var(--bg-color2); }
    .markdown-body table tr th, .markdown-body table tr td { padding: 12px 15px !important; line-height: 1.5; }
    .markdown-body ul.task-list-item { list-style-type: none; padding-left: 0; }
    .markdown-body .task-list-item input[type="checkbox"] { margin-right: 8px; }
    .markdown-body .mermaid { text-align: center; margin-top: 16px; }

    /* ç›®å½•æ ·å¼ */
    #toc-container { background-color: #ffffff; padding: 1.5rem; transition: transform 0.3s ease-in-out; position: relative; }
    #toc-container ul { list-style-type: none; padding-left: 0; }
    #toc-container a { color: #4b5563; text-decoration: none; display: block; padding: 4px 0; transition: all 0.2s; border-left: 2px solid transparent; padding-left: 10px; }
    #toc-container a:hover { color: #111827; }
    #toc-container a.toc-active { color: var(--color-1); font-weight: 700; border-left-color: var(--color-1); }
    #toc-container .toc-h1 { font-weight: bold; }
    #toc-container .toc-h2 { padding-left: 1rem; }
    #toc-container .toc-h3 { padding-left: 2rem; }
    #toc-container .toc-h4 { padding-left: 3rem; }

    /* Resizer Handle */
    #resizer {
      position: absolute;
      top: 0;
      right: -5px; /* å°†æ‹–åŠ¨æ¡ä¸­å¿ƒå¯¹å‡†è¾¹ç¼˜ */
      width: 10px; /* å¢åŠ å¯ç‚¹å‡»åŒºåŸŸçš„å®½åº¦ */
      height: 100%;
      cursor: col-resize;
      background-color: transparent; /* ä¿æŒæ‹–åŠ¨æ¡æœ¬èº«ä¸å¯è§ */
      z-index: 20;
    }
    /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºä¸€æ¡ç»†çº¿ä½œä¸ºè§†è§‰æç¤º */
    #resizer::after {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 100%;
      background-color: transparent;
      transition: background-color 0.2s ease;
    }
    #resizer:hover::after {
      background-color: var(--color-1);
    }


    /* CodeMirror ä¸»é¢˜è¦†ç›– */
    .cm-s-base16-light.CodeMirror { background: #fdfdfd; color: #202020; }
    .cm-s-base16-light .cm-header {color: #a0a0a0;}
    .cm-s-base16-light .cm-strong {font-weight: bold;}

    /* æ¡Œé¢ç«¯æ¨¡å¼åˆ‡æ¢ */
    @media (min-width: 769px) {
      .is-side-by-side #toc-container { display: none; }
      .is-preview-only #editor-wrapper { display: none; }
    }

    /* ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€ */
    @media (max-width: 768px) {
      #main-content { flex-direction: column; }
      #preview-wrapper, #editor-wrapper { width: 100% !important; height: 50%; }
      .CodeMirror { border-top: 1px solid var(--border-color); border-right: none; }
      #toc-container {
        position: absolute; top: 0; left: 0; height: 100%; width: 280px; transform: translateX(-100%); z-index: 40; border-right: 1px solid #e5e7eb;
      }
      #toc-container.is-open { transform: translateX(0); }
      .is-preview-only #editor-wrapper { display: none; }
      .is-preview-only #preview-wrapper { height: 100%; }
      .markdown-body { padding: 16px; }
      header { flex-direction: column; align-items: stretch; gap: 0.5rem; }
      #resizer { display: none; }
    }
  </style>
</head>
<body>

<div id="app-container">
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <header class="flex-shrink-0 bg-white text-gray-800 p-2 flex items-center justify-between shadow-md z-10">
    <div class="flex items-center space-x-4">
      <button id="toc-toggle-btn" class="p-2 rounded-md md:hidden hover:bg-gray-200">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
      </button>
      <h1 class="text-lg font-semibold text-gray-900">Markdown Pro</h1>
    </div>
    <div class="flex items-center space-x-2 md:space-x-4 flex-wrap justify-end">
      <button id="upload-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 md:px-4 rounded transition duration-300 text-sm">ä¸Šä¼ </button>
      <input type="file" id="file-input" accept=".md,.markdown" class="hidden">
      <button id="export-pdf-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 md:px-4 rounded transition duration-300 text-sm">å¯¼å‡ºPDF</button>
      <button id="mode-toggle-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-3 md:px-4 rounded transition duration-300 text-sm">ä»…é¢„è§ˆ</button>
      <button id="fullscreen-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-3 md:px-4 rounded transition duration-300 text-sm">å…¨å±</button>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <main id="main-content" class="main-content relative is-side-by-side">
    <!-- ç›®å½• (ç§»è‡³å·¦ä¾§) -->
    <div id="toc-container" class="w-[24rem] flex-shrink-0">
      <h2 class="text-gray-900 font-bold text-xl mb-4">ç›®å½•</h2>
      <div id="toc"></div>
      <div id="resizer"></div>
    </div>
    <!-- é¢„è§ˆåŒº -->
    <div id="preview-wrapper" class="flex-1 bg-gray-50">
      <div id="preview" class="markdown-body"></div>
    </div>
    <!-- ç¼–è¾‘å™¨ -->
    <div id="editor-wrapper" class="flex-1">
      <textarea id="editor"></textarea>
    </div>
  </main>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    mermaid.initialize({ startOnLoad: false, theme: 'neutral' });
    const { jsPDF } = window.jspdf;

    // DOM å…ƒç´ è·å–
    const mainContent = document.getElementById('main-content');
    const editorWrapper = document.getElementById('editor-wrapper');
    const editorTextarea = document.getElementById('editor');
    const previewWrapper = document.getElementById('preview-wrapper');
    const preview = document.getElementById('preview');
    const tocContainer = document.getElementById('toc-container');
    const tocDiv = document.getElementById('toc');
    const resizer = document.getElementById('resizer');
    const modeToggleBtn = document.getElementById('mode-toggle-btn');
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const uploadBtn = document.getElementById('upload-btn');
    const fileInput = document.getElementById('file-input');
    const exportPdfBtn = document.getElementById('export-pdf-btn');
    const appContainer = document.getElementById('app-container');
    const tocToggleBtn = document.getElementById('toc-toggle-btn');

    // åˆå§‹åŒ– CodeMirror ç¼–è¾‘å™¨
    const editor = CodeMirror.fromTextArea(editorTextarea, {
      mode: 'markdown', theme: 'base16-light', lineNumbers: true, lineWrapping: true,
    });
    editor.setSize('100%', '100%');
    const editorScroller = editor.getScrollerElement();

    let isSyncing = false;
    let intersectionObserver;
    let isClickScrolling = false;

    // è®¾ç½® marked.js å¹¶é›†æˆ KaTeX
    marked.use(
            window.markedKatex({ throwOnError: false })
    );

    marked.setOptions({
      highlight: (code, lang) => {
        if (lang === 'mermaid') {
          return code;
        }
        try {
          const language = hljs.getLanguage(lang) ? lang : 'plaintext';
          return hljs.highlight(code, { language, ignoreIllegals: true }).value;
        } catch (e) {
          return code; // return original code on error
        }
      },
      gfm: true,
      breaks: true,
    });

    const render = (markdownText) => {
      preview.innerHTML = marked.parse(markdownText);

      const codeBlocks = preview.querySelectorAll('pre code.language-mermaid');
      codeBlocks.forEach((codeBlock) => {
        const mermaidContainer = document.createElement('div');
        mermaidContainer.className = 'mermaid';
        mermaidContainer.textContent = codeBlock.textContent;
        codeBlock.parentElement.replaceWith(mermaidContainer);
      });

      generateTOC();
      setupIntersectionObserver();
      setTimeout(() => {
        try {
          const mermaidNodes = preview.querySelectorAll('.mermaid');
          if (mermaidNodes.length > 0) {
            mermaid.run({ nodes: mermaidNodes }).catch(e => console.error("Mermaid rendering error:", e));
          }
        } catch(e) { console.error("Mermaid rendering error:", e); }
      }, 100);
    };

    const generateTOC = () => {
      tocDiv.innerHTML = '';
      const headings = preview.querySelectorAll('h1, h2, h3, h4');
      if (headings.length === 0) {
        tocDiv.innerHTML = '<p class="text-gray-500">æœªæ‰¾åˆ°æ ‡é¢˜</p>';
        return;
      }
      const tocList = document.createElement('ul');
      headings.forEach((heading, index) => {
        const level = parseInt(heading.tagName.substring(1), 10);
        const text = heading.textContent;
        const id = 'heading-' + text.toLowerCase().replace(/[^a-z0-9\u4e00-\u9fa5]+/g, '-') + '-' + index;
        heading.id = id;
        const link = document.createElement('a');
        link.href = '#' + id;
        link.textContent = text;
        link.className = `toc-h${level}`;
        link.dataset.targetId = id;
        link.onclick = (e) => {
          e.preventDefault();
          isClickScrolling = true;
          document.querySelectorAll('#toc a').forEach(a => a.classList.remove('toc-active'));
          link.classList.add('toc-active');
          heading.scrollIntoView({ behavior: 'smooth' });
          setTimeout(() => { isClickScrolling = false; }, 1000);
          if (window.innerWidth <= 768) {
            tocContainer.classList.remove('is-open');
          }
        };
        const listItem = document.createElement('li');
        listItem.appendChild(link);
        tocList.appendChild(listItem);
      });
      tocDiv.appendChild(tocList);
    };

    const setupIntersectionObserver = () => {
      if (intersectionObserver) intersectionObserver.disconnect();
      const options = { root: previewWrapper, rootMargin: "0px 0px -80% 0px", threshold: 0 };
      intersectionObserver = new IntersectionObserver((entries) => {
        if (isClickScrolling) return;
        document.querySelectorAll('#toc a').forEach(a => a.classList.remove('toc-active'));
        const intersectingEntries = entries.filter(e => e.isIntersecting);
        if (intersectingEntries.length > 0) {
          const targetId = intersectingEntries[0].target.id;
          const activeLink = document.querySelector(`#toc a[data-target-id="${targetId}"]`);
          if (activeLink) activeLink.classList.add('toc-active');
        }
      }, options);
      preview.querySelectorAll('h1, h2, h3, h4').forEach(h => intersectionObserver.observe(h));
    };

    editor.on('change', () => render(editor.getValue()));

    const syncScroll = (source, target) => {
      if (isSyncing) return;
      isSyncing = true;
      const percent = source.scrollTop / (source.scrollHeight - source.clientHeight);
      target.scrollTop = (target.scrollHeight - target.clientHeight) * percent;
      setTimeout(() => { isSyncing = false; }, 50);
    };

    editorScroller.addEventListener('scroll', () => syncScroll(editorScroller, previewWrapper));
    previewWrapper.addEventListener('scroll', () => syncScroll(previewWrapper, editorScroller));

    modeToggleBtn.addEventListener('click', () => {
      if (mainContent.classList.contains('is-side-by-side')) {
        mainContent.classList.remove('is-side-by-side');
        mainContent.classList.add('is-preview-only');
        modeToggleBtn.textContent = 'å¯¹ç…§æ¨¡å¼';
      } else {
        mainContent.classList.remove('is-preview-only');
        mainContent.classList.add('is-side-by-side');
        modeToggleBtn.textContent = 'ä»…é¢„è§ˆ';
      }
    });

    tocToggleBtn.addEventListener('click', () => {
      tocContainer.classList.toggle('is-open');
    });

    // TOC Resizer Logic
    let isResizing = false;
    resizer.addEventListener('mousedown', (e) => {
      isResizing = true;
      document.body.style.cursor = 'col-resize';
      document.body.style.userSelect = 'none';
    });

    window.addEventListener('mousemove', (e) => {
      if (!isResizing) return;
      const tocWidth = e.clientX;
      if (tocWidth > 150 && tocWidth < 800) { // Set min/max width
        tocContainer.style.width = `${tocWidth}px`;
      }
    });

    window.addEventListener('mouseup', () => {
      isResizing = false;
      document.body.style.cursor = 'default';
      document.body.style.userSelect = 'auto';
    });

    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) appContainer.requestFullscreen().catch(err => alert(`å…¨å±å¤±è´¥: ${err.message}`));
      else document.exitFullscreen();
    });
    document.addEventListener('fullscreenchange', () => {
      fullscreenBtn.textContent = document.fullscreenElement ? 'é€€å‡ºå…¨å±' : 'å…¨å±';
    });

    uploadBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => editor.setValue(event.target.result);
        reader.readAsText(file);
      }
      e.target.value = '';
    });

    exportPdfBtn.addEventListener('click', async () => {
      const originalText = exportPdfBtn.textContent;
      exportPdfBtn.textContent = 'ç”Ÿæˆä¸­...';
      exportPdfBtn.disabled = true;

      const printContainer = document.createElement('div');
      printContainer.style.position = 'absolute';
      printContainer.style.left = '-9999px';
      printContainer.style.width = '1280px';
      printContainer.style.display = 'flex';
      printContainer.style.backgroundColor = 'var(--bg-color)';

      const tocClone = document.createElement('div');
      tocClone.style.width = '25%';
      tocClone.style.backgroundColor = '#ffffff';
      tocClone.style.borderRight = '1px solid #e5e7eb';
      tocClone.style.padding = '1.5rem';
      tocClone.innerHTML = tocContainer.innerHTML;
      tocClone.querySelectorAll('a').forEach(a => a.onclick = null);

      const previewClone = document.createElement('div');
      previewClone.style.width = '75%';
      previewClone.style.backgroundColor = 'rgb(249 250 251)';
      previewClone.innerHTML = previewWrapper.innerHTML;

      printContainer.appendChild(tocClone);
      printContainer.appendChild(previewClone);
      document.body.appendChild(printContainer);

      try {
        const canvas = await html2canvas(printContainer, { scale: 1, useCORS: true, windowWidth: printContainer.scrollWidth, windowHeight: printContainer.scrollHeight });
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF({ orientation: 'p', unit: 'pt', format: 'a4' });
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
        let heightLeft = pdfHeight, position = 0;
        pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
        heightLeft -= pdf.internal.pageSize.getHeight();
        while (heightLeft > 0) {
          position = heightLeft - pdfHeight;
          pdf.addPage();
          pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, pdfHeight);
          heightLeft -= pdf.internal.pageSize.getHeight();
        }
        pdf.save('markdown-export.pdf');
      } catch (error) {
        console.error("å¯¼å‡º PDF å¤±è´¥:", error);
        alert("æŠ±æ­‰ï¼Œå¯¼å‡º PDF æ—¶å‘ç”Ÿé”™è¯¯ã€‚");
      } finally {
        document.body.removeChild(printContainer);
        exportPdfBtn.textContent = originalText;
        exportPdfBtn.disabled = false;
      }
    });

    const initialMarkdown = `# æ¬¢è¿ä½¿ç”¨ Markdown Pro!

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Markdown ç¼–è¾‘å™¨å’Œé˜…è¯»å™¨ã€‚

## LaTeX æ•°å­¦å…¬å¼

**ç°åœ¨æ”¯æŒ KaTeX æ¸²æŸ“çš„æ•°å­¦å…¬å¼ï¼**

è¡Œå†…å…¬å¼: $E=mc^2$

å—çº§å…¬å¼:
$$\\int_a^b f(x) \\, dx = F(b) - F(a)$$

## Mermaid å›¾è¡¨ç¤ºä¾‹

\`\`\`mermaid
graph TD;
    A[å¼€å§‹] --> B{å¤„ç†};
    B -->|æ¡ä»¶1| C[ç»“æœ1];
    B -->|æ¡ä»¶2| D[ç»“æœ2];
\`\`\`

## ä»£ç å—ç¤ºä¾‹
\`\`\`javascript
function greet() {
  console.log("Hello, World!");
}
\`\`\`

> ç°åœ¨ï¼Œå¼€å§‹æ‚¨çš„åˆ›ä½œå§ï¼`;

    editor.setValue(initialMarkdown);
    render(initialMarkdown);
  });
</script>

</body>
</html>

```
